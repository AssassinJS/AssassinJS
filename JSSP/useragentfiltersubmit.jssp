<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css" />
</head>
<body>

<div id="bodyWrapper">

<div id="headerWrapper">
<div id="headerContent">
<div class="headingText left">Assassin.js</div>
<div class="headingText right">Assassin Panel</div>
</div>
</div>
<div id="contentWrapper">

<div id="contentLeft">
<div id="projectMenu" class="glowBoxBlue">
<a class="navMenuLink" href="./home.jssp">Home</a><br />
<a class="navMenuLink" href="./routes.jssp">Configure Project Routes</a><br />
<a class="navMenuLink" href="./filters.jssp">Configure Filters</a><br />
<a class="navMenuLink" href="./index.jssp">Logout</a>
</div>
</div>
<div id="contentRight">
<$
var qs = require('querystring');
var logger = require('../system/logger');
var MyMongo = require('../system/dbconnect.js').MyMongo;
var db = new MyMongo('localhost', 27017, 'assassindb');
$>
<$
var userAgentFilterParameters = __dataObj['filterDB']['user-agent'];
var routesList = __dataObj['routesDB'];
var newUAFilters = qs.parse(__request.body);
$>

<$=newUAFilters.routes$>
<$
	db.query('filterParameters',function(collection){
				
		var toSet = {};
		var toSetFlag = true;
		toSet.parameters = userAgentFilterParameters;
		if(newUAFilters.routes !=null ||newUAFilters.routes !=undefined)
		{
			for(var i in newUAFilters.routes)
			{
				var toSetObj = {};
				toSetObj.url=newUAFilters.routes[i];
				toSetObj.params = {};
				toSetObj.params['allow'] = newUAFilters.useragentWhite;
				toSetObj.params['block'] = newUAFilters.useragentBlack;
				
				for(var j in toSet.parameters)
				{
					if(toSet.parameters[j].url == newUAfilters.routes[i])
					{
						toSet.parameters[j].params = toSetObj.params;
						toSetFlag = false;
						break;
					}
				}
				if(toSetFlag)
					toSet.parameters.push(toSetObj);
			}
			collection.update({filter:'user-agent'},{$set:toSet},{upsert:true, w:1},function(err,data){
				if(err)logger.write(err,'useragentfiltersubmit.jssp');		
				else
				{
					require('../filters/user-agent').ReadFromDB();
					require('../controllers/assassinPanel').getDBParameterObjects();
				}
			});
		}
		
		
	});
$>



</div>

</div>
<div id="footerWrapper">
<div id="footerContent">
(c)2013 Adithya Chebiyyam and Sai Teja Jammalamadaka
</div>
</div>

</div>

<script language="javascript">
function toggle(tag) {
	checkboxes = [];
	if(tag.id=="useragentBlackToggle")
	{
		checkboxes = document.getElementsByName("useragentBlack");
	}
	if(tag.id=="useragentWhiteToggle")
	{
		checkboxes = document.getElementsByName("useragentWhite");
	}
	if(tag.id=="routesToggle")
	{
		checkboxes = document.getElementsByName("routes");
	}
	for(var i in checkboxes)
		checkboxes[i].checked = tag.checked;
}
</script>

</body>
</html>
